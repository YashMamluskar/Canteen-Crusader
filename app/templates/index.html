<!-- app/templates/index.html -->
{% extends "base.html" %}

{% block content %}
    <!-- Jumbotron with Interactive Particle Background -->
    <div class="jumbotron text-center p-5 mb-0">
        <div id="tsparticles"></div>
        <div class="content">
            <h1 class="display-4" data-aos="fade-down">Welcome to the Canteen Crusader! üöÄ</h1>
            <p class="lead" data-aos="fade-up" data-aos-delay="200">Your one-stop guide to the best food on campus. Rate, review, and discover hidden gems.</p>
            <hr class="my-4">
            <a class="btn btn-primary btn-lg" href="{{ url_for('main.menu') }}" role="button" data-aos="zoom-in" data-aos-delay="400">Browse the Menu</a>
        </div>
    </div>

    <div class="container py-5">
        <!-- "For You" Recommendations Section -->
        {% if recommendations %}
        <div class="mb-5" data-aos="fade-up">
            <h2 class="mb-4 text-center">üí° Just For You</h2>
            <p class="text-center text-muted">Because you seem to enjoy the '{{ recommended_for_category }}' category, you might also like these!</p>
            <div class="row justify-content-center">
                {% for item in recommendations %}
                <div class="col-md-4 mb-4">
                    <div class="card h-100 text-center">
                        <img src="{{ item.image_url }}" class="card-img-top" alt="Image of {{ item.name }}" onerror="this.onerror=null;this.src='https://placehold.co/600x400/CCCCCC/FFFFFF?text=Image+Not+Found';">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">{{ item.name }}</h5>
                            <p class="card-text fs-4">‚≠ê <strong>{{ item.avg_rating }}</strong> <small>/ 5.0</small></p>
                            <a href="{{ url_for('main.item_detail', item_id=item.id) }}" class="btn btn-sm btn-outline-primary mt-auto">View</a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        <hr class="my-5">
        {% endif %}

        <!-- NEW: Top Rated Carousel -->
        <div class="mb-5" data-aos="fade-up">
            <h2 class="mb-4 text-center">üåü Top Rated Dishes</h2>
            <div class="swiper top-rated-swiper">
                <div class="swiper-wrapper">
                    {% for item in top_items %}
                    <div class="swiper-slide">
                        <div class="card h-100 text-center">
                            <img src="{{ item.image_url }}" alt="Image of {{ item.name }}" onerror="this.onerror=null;this.src='https://placehold.co/600x400/CCCCCC/FFFFFF?text=Image+Not+Found';">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">{{ item.name }}</h5>
                                <p class="card-text fs-4">‚≠ê <strong>{{ item.avg_rating }}</strong> <small>/ 5.0</small></p>
                                <a href="{{ url_for('main.item_detail', item_id=item.id) }}" class="btn btn-sm btn-outline-primary mt-auto">View</a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
                <div class="swiper-pagination"></div>
            </div>
        </div>

        <!-- NEW: Trending Carousel -->
        <div data-aos="fade-up">
            <h2 class="mb-4 text-center">üî• Trending This Week</h2>
            <div class="swiper trending-swiper">
                <div class="swiper-wrapper">
                    {% for item in trending_items %}
                    <div class="swiper-slide">
                        <div class="card h-100 text-center">
                            <img src="{{ item.image_url }}" alt="Image of {{ item.name }}" onerror="this.onerror=null;this.src='https://placehold.co/600x400/CCCCCC/FFFFFF?text=Image+Not+Found';">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">{{ item.name }}</h5>
                                <p class="text-muted">{{ item.review_count }} recent reviews</p>
                                <a href="{{ url_for('main.item_detail', item_id=item.id) }}" class="btn btn-sm btn-outline-primary mt-auto">View</a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
                <div class="swiper-pagination"></div>
            </div>
        </div>
    </div>
    
    <div class="parallax" data-aos="zoom-in">
        <div class="parallax-overlay">
            <h2 class="display-5">Discover. Rate. Enjoy.</h2>
            <p class="lead">Your opinion matters. Help fellow students find the best eats on campus.</p>
        </div>
    </div>

    <!-- NEW: Top Reviewers Leaderboard -->
    <div class="container py-5">
        <div data-aos="fade-up">
            <h2 class="mb-4 text-center">üèÜ Top Reviewers</h2>
            <div class="list-group">
                {% for user, review_count in top_reviewers %}
                    <a href="{{ url_for('main.user_profile', username=user.username) }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <span class="badge bg-primary rounded-pill me-3 fs-6">{{ loop.index }}</span>
                            <h5 class="mb-0">{{ user.username }}</h5>
                        </div>
                        <span class="badge bg-secondary rounded-pill">{{ review_count }} Reviews</span>
                    </a>
                {% else %}
                    <p class="text-center">No reviews have been written yet. Be the first!</p>
                {% endfor %}
            </div>
        </div>
    </div>
    
{% endblock content %}

{% block scripts %}
    <script>
        // tsParticles Configuration
        document.addEventListener('DOMContentLoaded', (event) => {
            tsParticles.load("tsparticles", {
                // ... tsParticles configuration ...
            });
        });

        // Initialize Top Rated Swiper
        var topRatedSwiper = new Swiper('.top-rated-swiper', {
            effect: 'coverflow',
            grabCursor: true,
            centeredSlides: true,
            slidesPerView: 'auto',
            loop: true,
            initialSlide: 1, // Start on the second slide (the center one)
            coverflowEffect: {
                rotate: 50,
                stretch: 0,
                depth: 100,
                modifier: 1,
                slideShadows: true,
            },
            pagination: {
                el: '.swiper-pagination',
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
        });

        // Initialize Trending Swiper
        var trendingSwiper = new Swiper('.trending-swiper', {
            effect: 'coverflow',
            grabCursor: true,
            centeredSlides: true,
            slidesPerView: 'auto',
            loop: true,
            initialSlide: 1, // Start on the second slide (the center one)
            coverflowEffect: {
                rotate: 50,
                stretch: 0,
                depth: 100,
                modifier: 1,
                slideShadows: true,
            },
            pagination: {
                el: '.swiper-pagination',
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
        });
    </script>
{% endblock scripts %}
